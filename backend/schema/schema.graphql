scalar Date
scalar JSON

type User {
  id: ID!
  email: String!
  displayName: String!
  photoURL: String!
  usernameLower: String
  createdAt: Date!
  updatedAt: Date!
  lastActiveAt: Date!
  profile: UserProfile
  privacy: UserPrivacy
}

type UserProfile {
  id: ID!
  userId: ID!
  age: Int
  weight: Float
  height: Float
  activityLevel: String
  gender: String
  createdAt: Date!
  updatedAt: Date!
  user: User!
}

type UserPrivacy {
  id: ID!
  userId: ID!
  ringsVisibility: String!
  allowFriendRequests: Boolean!
  allowClanInvites: Boolean!
  createdAt: Date!
  updatedAt: Date!
  user: User!
}

type DailyHealthData {
  id: ID!
  userId: ID!
  date: String!
  caloriesConsumed: Float!
  caloriesBurned: Float!
  activeEnergyBurned: Float
  dietaryEnergyConsumed: Float
  heartRate: Int
  restingHeartRate: Int
  steps: Int!
  waterIntake: Float!
  createdAt: Date!
  updatedAt: Date!
  meals: [Meal!]!
  waterEntries: [WaterEntry!]!
  workouts: [Workout!]!
  fastingSession: FastingSession
}

type Meal {
  id: ID!
  dailyHealthDataId: ID!
  type: String!
  name: String!
  calories: Float!
  carbs: Float!
  protein: Float!
  fat: Float!
  timestamp: Date!
  createdAt: Date!
}

type WaterEntry {
  id: ID!
  dailyHealthDataId: ID!
  glasses: Float!
  timestamp: Date!
  createdAt: Date!
}

type Workout {
  id: ID!
  dailyHealthDataId: ID!
  name: String!
  type: String!
  startTime: Date!
  endTime: Date
  duration: Int!
  totalCaloriesBurned: Float!
  distance: Float
  averageSpeed: Float
  maxSpeed: Float
  createdAt: Date!
  updatedAt: Date!
  exercises: [Exercise!]!
  locationPoints: [LocationPoint!]!
}

type Exercise {
  id: ID!
  workoutId: ID!
  name: String!
  category: String!
  duration: Int
  sets: Int
  reps: Int
  weight: Float
  caloriesBurned: Float
  notes: String
  createdAt: Date!
}

type LocationPoint {
  id: ID!
  workoutId: ID!
  latitude: Float!
  longitude: Float!
  timestamp: Date!
  altitude: Float
  speed: Float
  accuracy: Float
  createdAt: Date!
}

type FastingSession {
  id: ID!
  dailyHealthDataId: ID!
  type: String!
  startTime: Date!
  endTime: Date
  duration: Int!
  targetDuration: Int
  eatingWindowStart: Int
  eatingWindowEnd: Int
  createdAt: Date!
  updatedAt: Date!
}

type Friend {
  id: ID!
  userId: ID!
  friendUid: ID!
  ringsShare: Boolean!
  createdAt: Date!
  friend: User!
}

type FriendRequest {
  id: ID!
  fromUid: ID!
  toUid: ID!
  status: String!
  createdAt: Date!
  updatedAt: Date!
  fromUser: User!
  toUser: User!
}

type Clan {
  id: ID!
  name: String!
  description: String!
  photoURL: String!
  ownerUid: ID!
  privacy: String!
  createdAt: Date!
  updatedAt: Date!
  owner: User!
  members: [ClanMember!]!
}

type ClanMember {
  id: ID!
  clanId: ID!
  uid: ID!
  role: String!
  status: String!
  joinedAt: Date!
  clan: Clan!
  user: User!
}

type ClanInvite {
  id: ID!
  clanId: ID!
  fromUid: ID!
  toUid: ID!
  status: String!
  createdAt: Date!
  updatedAt: Date!
  clan: Clan!
  fromUser: User!
  toUser: User!
}

type Notification {
  id: ID!
  userId: ID!
  type: String!
  title: String!
  body: String!
  data: JSON!
  read: Boolean!
  createdAt: Date!
}

type RingStats {
  id: ID!
  userId: ID!
  date: String!
  caloriesBurned: Float!
  steps: Int!
  workoutMinutes: Int!
  goalCalories: Float!
  goalSteps: Int!
  goalMinutes: Int!
  updatedAt: Date!
}

type AuthPayload {
  token: String!
  refreshToken: String!
  user: User!
}

# Input Types
input UserProfileInput {
  age: Int
  weight: Float
  height: Float
  activityLevel: String
  gender: String
}

input UserPrivacyInput {
  ringsVisibility: String
  allowFriendRequests: Boolean
  allowClanInvites: Boolean
}

input MealInput {
  type: String!
  name: String!
  calories: Float!
  carbs: Float!
  protein: Float!
  fat: Float!
  timestamp: Date!
}

input WaterEntryInput {
  glasses: Float!
  timestamp: Date!
}

input ExerciseInput {
  name: String!
  category: String!
  duration: Int
  sets: Int
  reps: Int
  weight: Float
  caloriesBurned: Float
  notes: String
}

input LocationPointInput {
  latitude: Float!
  longitude: Float!
  timestamp: Date!
  altitude: Float
  speed: Float
  accuracy: Float
}

input WorkoutInput {
  name: String!
  type: String!
  startTime: Date!
  endTime: Date
  duration: Int!
  totalCaloriesBurned: Float!
  distance: Float
  averageSpeed: Float
  maxSpeed: Float
  exercises: [ExerciseInput!]!
  locationPoints: [LocationPointInput!]
}

input FastingSessionInput {
  type: String!
  startTime: Date!
  endTime: Date
  duration: Int!
  targetDuration: Int
  eatingWindowStart: Int
  eatingWindowEnd: Int
}

input DailyHealthDataInput {
  date: String!
  caloriesConsumed: Float
  caloriesBurned: Float
  activeEnergyBurned: Float
  dietaryEnergyConsumed: Float
  heartRate: Int
  restingHeartRate: Int
  steps: Int
  waterIntake: Float
  meals: [MealInput!]
  waterEntries: [WaterEntryInput!]
  workouts: [WorkoutInput!]
  fastingSession: FastingSessionInput
}

input RingStatsInput {
  date: String!
  caloriesBurned: Float!
  steps: Int!
  workoutMinutes: Int!
  goalCalories: Float!
  goalSteps: Int!
  goalMinutes: Int!
}

# Queries
type Query {
  me: User
  user(id: ID!): User
  users(search: String, limit: Int, offset: Int): [User!]!
  dailyHealthData(date: String!): DailyHealthData
  weeklyHealthData(startDate: String!): [DailyHealthData!]!
  friends: [Friend!]!
  friendRequests: FriendRequestsResponse!
  clans: [Clan!]!
  clan(id: ID!): Clan
  clanInvites: [ClanInvite!]!
  notifications(limit: Int, offset: Int): [Notification!]!
  unreadNotificationCount: Int!
  ringStats(date: String!): RingStats
}

type FriendRequestsResponse {
  sent: [FriendRequest!]!
  received: [FriendRequest!]!
}

# Mutations
type Mutation {
  # Auth
  register(email: String!, password: String!, displayName: String, username: String): AuthPayload!
  login(email: String!, password: String!): AuthPayload!
  refreshToken(refreshToken: String!): AuthPayload!
  updateProfile(profile: UserProfileInput!): UserProfile!
  updatePrivacy(privacy: UserPrivacyInput!): UserPrivacy!

  # Health Data
  saveDailyHealthData(data: DailyHealthDataInput!): DailyHealthData!
  addMeal(date: String!, meal: MealInput!): Meal!
  updateMeal(id: ID!, meal: MealInput!): Meal!
  deleteMeal(id: ID!): Boolean!
  addWaterEntry(date: String!, entry: WaterEntryInput!): WaterEntry!
  addWorkout(date: String!, workout: WorkoutInput!): Workout!
  updateWorkout(id: ID!, workout: WorkoutInput!): Workout!
  deleteWorkout(id: ID!): Boolean!
  saveFastingSession(date: String!, session: FastingSessionInput!): FastingSession!

  # Community
  sendFriendRequest(toUid: ID!): FriendRequest!
  acceptFriendRequest(fromUid: ID!): Friend!
  rejectFriendRequest(fromUid: ID!): Boolean!
  cancelFriendRequest(toUid: ID!): Boolean!
  removeFriend(friendUid: ID!): Boolean!
  blockUser(blockedUid: ID!): Boolean!
  unblockUser(blockedUid: ID!): Boolean!

  # Clans
  createClan(name: String!, description: String, privacy: String): Clan!
  updateClanDetails(clanId: ID!, name: String, description: String, photoURL: String, privacy: String): Clan!
  inviteToClan(clanId: ID!, toUid: ID!): ClanInvite!
  respondClanInvite(clanId: ID!, action: String!): Boolean!
  leaveClan(clanId: ID!): Boolean!
  removeClanMember(clanId: ID!, memberUid: ID!): Boolean!
  updateClanRole(clanId: ID!, memberUid: ID!, newRole: String!): ClanMember!

  # Notifications
  markNotificationRead(notificationId: ID!): Notification!
  markAllNotificationsRead: Boolean!

  # Ring Stats
  updateRingStats(stats: RingStatsInput!): RingStats!
}

